<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard - Sistema de Facturación</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background-color: #f8f9fa;
      overflow-x: hidden;
    }
    .sidebar {
      height: 100vh;
      background-color: #343a40;
      padding-top: 1rem;
      position: fixed;
      width: 250px;
      overflow-y: auto;
      color: #fff;
      transition: all 0.3s ease;
    }
    .sidebar.collapsed {
      margin-left: -250px;
    }
    .sidebar .user-info {
      padding: 1rem;
      border-bottom: 1px solid #495057;
      text-align: center;
    }
    .sidebar .nav-link {
      color: #adb5bd;
      font-weight: 500;
    }
    .sidebar .nav-link:hover {
      background-color: #495057;
      color: #fff;
    }
    .accordion-button {
      background-color: #343a40;
      color: #fff;
    }
    .accordion-button:not(.collapsed) {
      background-color: #495057;
      color: #fff;
    }
    .accordion-body a {
      color: #adb5bd;
      text-decoration: none;
      display: block;
      margin: 0.25rem 0;
      padding-left: 1rem;
    }
    .accordion-body a:hover {
      color: #ffffff;
    }
    .content {
      margin-left: 250px;
      padding: 2rem;
      transition: all 0.3s ease;
    }
    .content.expanded {
      margin-left: 0;
    }
    .toggle-btn {
      position: fixed;
      top: 15px;
      left: 15px;
      background-color: #343a40;
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 5px;
      z-index: 1001;
    }
  </style>
</head>
<body>

  <!-- Botón toggle menú -->
  <button class="toggle-btn" id="toggleMenu" aria-label="Alternar menú">
    <i class="bi bi-list fs-4"></i>
  </button>

  <!-- Sidebar -->
  <nav class="sidebar d-flex flex-column" id="sidebar" aria-label="Menú lateral">
    <div class="user-info">
      <i class="bi bi-person-circle fs-1"></i>
      <h5 class="mt-2">{{ nombre_usuario if nombre_usuario else "Nombre Usuario" }}</h5>
    </div>

    <!-- Menú principal -->
    <div class="accordion" id="menuAccordion">

      <!-- Usuarios -->
      <div class="accordion-item bg-transparent border-0">
        <h2 class="accordion-header" id="headingUsuarios">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseUsuarios">
            <i class="bi bi-people-fill me-2"></i>Usuarios
          </button>
        </h2>
        <div id="collapseUsuarios" class="accordion-collapse collapse" aria-labelledby="headingUsuarios" data-bs-parent="#menuAccordion">
          <div class="accordion-body">
            <a href="{{ url_for('usuarios.registrar_usuario') }}" class="btn btn-outline-primary btn-sm">Registrar Usuario</a>
            <a href="{{ url_for('usuarios.listar_usuarios') }}" class="btn btn-outline-primary btn-sm">Lista de Usuarios</a>
          </div>
        </div>
      </div>

      <!-- Productos -->
      <div class="accordion-item bg-transparent border-0">
        <h2 class="accordion-header" id="headingProductos">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseProductos">
            <i class="bi bi-box-seam me-2"></i>Productos
          </button>
        </h2>
        <div id="collapseProductos" class="accordion-collapse collapse" aria-labelledby="headingProductos" data-bs-parent="#menuAccordion">
          <div class="accordion-body">
            <a href="{{ url_for('productos.mostrar_y_agregar_productos') }}" class="btn btn-outline-primary btn-sm">Registrar Productos</a>
            <a href="{{ url_for('productos.stock') }}" class="btn btn-outline-primary btn-sm">Stock de Productos</a>
            <a href="{{ url_for('productos.productos_vendidos') }}" class="btn btn-outline-primary btn-sm">Comprobantes Emitidos</a>
          </div>
        </div>
      </div>

      <!-- Proveedores -->
      <div class="accordion-item bg-transparent border-0">
        <h2 class="accordion-header" id="headingProveedores">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseProveedores">
            <i class="bi bi-truck me-2"></i>Proveedores
          </button>
        </h2>
        <div id="collapseProveedores" class="accordion-collapse collapse" aria-labelledby="headingProveedores" data-bs-parent="#menuAccordion">
          <div class="accordion-body">
            <a href="{{ url_for('proveedores.crear_proveedor') }}" class="btn btn-outline-primary btn-sm">Registrar Proveedor</a>
            <a href="{{ url_for('proveedores.listar_proveedores') }}" class="btn btn-outline-primary btn-sm">Lista de Proveedores</a>
          </div>
        </div>
      </div>

      <!-- Clientes -->
      <div class="accordion-item bg-transparent border-0">
        <h2 class="accordion-header" id="headingClientes">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseClientes">
            <i class="bi bi-people me-2"></i>Clientes
          </button>
        </h2>
        <div id="collapseClientes" class="accordion-collapse collapse" aria-labelledby="headingClientes" data-bs-parent="#menuAccordion">
          <div class="accordion-body">
            <a href="{{ url_for('clientes.crear_cliente') }}" class="btn btn-outline-primary btn-sm">Registrar Cliente</a>
            <a href="{{ url_for('clientes.listar_clientes') }}" class="btn btn-outline-primary btn-sm">Lista de Clientes</a>
          </div>
        </div>
      </div>

      <!-- Ventas -->
      <div class="accordion-item bg-transparent border-0">
        <h2 class="accordion-header" id="headingVentas">
          <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseVentas">
            <i class="bi bi-receipt-cutoff me-2"></i>Ventas
          </button>
        </h2>
        <div id="collapseVentas" class="accordion-collapse collapse" aria-labelledby="headingVentas" data-bs-parent="#menuAccordion">
          <div class="accordion-body">
            <a href="{{ url_for('facturas.listar_facturas') }}" class="btn btn-outline-primary btn-sm">Ver Facturas</a>
            <a href="{{ url_for('facturas.nueva_factura') }}" class="btn btn-outline-primary btn-sm">Nueva Factura</a>
            <a href="{{ url_for('facturas.nueva_nota') }}" class="btn btn-outline-primary btn-sm">Nota Debito / Credito</a>
            <a href="{{ url_for('facturas.listar_notas') }}" class="btn btn-outline-primary btn-sm">Ver Notas</a>
          </div>
        </div>
      </div>

      <!-- Cerrar sesión -->
      <hr class="text-secondary mx-3" />
      <a href="{{ url_for('login.logout') }}" class="nav-link d-flex align-items-center px-3">
        <i class="bi bi-box-arrow-right me-2"></i> Cerrar Sesión
      </a>
    </div>
  </nav>

  <!-- Contenido principal -->
  <main class="content" id="mainContent" role="main">
    <div class="container text-center">
      <h1 class="mb-4">Dashboard</h1>

      <!-- KPIs -->
      <div class="row justify-content-center mb-4">
        <div class="col-md-3">
          <div class="card text-bg-primary mb-3">
            <div class="card-body">
              <h5 class="card-title">Total Clientes</h5>
              <p class="card-text fs-4">{{ total_clientes }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-bg-success mb-3">
            <div class="card-body">
              <h5 class="card-title">Total Ventas</h5>
              <p class="card-text fs-4">S/ {{ '%.2f' | format(total_ventas) }}</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card text-bg-warning mb-3">
            <div class="card-body">
              <h5 class="card-title">Productos Vendidos</h5>
              <p class="card-text fs-4">{{ productos_vendidos }}</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Gráfico de Barras -->
      <div class="row justify-content-center">
        <div class="col-md-8">
          <canvas id="kpiChart" height="100"></canvas>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="text-center text-muted py-3">
    <small>&copy; 2025 Sistema de Facturación. Todos los derechos reservados.</small>
  </footer>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Toggle Sidebar -->
  <script>
    const toggleBtn = document.getElementById('toggleMenu');
    const sidebar = document.getElementById('sidebar');
    const content = document.getElementById('mainContent');

    toggleBtn.addEventListener('click', () => {
      sidebar.classList.toggle('collapsed');
      content.classList.toggle('expanded');
    });
  </script>

  <!-- Chart.js Script -->
  <script>
    const ctx = document.getElementById('kpiChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Clientes', 'Ventas (S/)', 'Productos Vendidos'],
        datasets: [{
          label: 'Indicadores',
          data: [
            {{ total_clientes }},
            {{ total_ventas|float }},
            {{ productos_vendidos }}
          ],
          backgroundColor: ['#0d6efd', '#198754', '#ffc107']
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  </script>

</body>
</html> 